---
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <title>Mirador</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
  </head>
  <body>
    <div id="mirador" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0;"></div>
    <script>document.write("<script type='text/javascript' src='https://mirador-dev.netlify.app/dist/mirador.min.js?v=" + Date.now() + "'><\/script>");</script>
    <script type="text/javascript">
      var map = {
{% for chapter in site.data.chapters %}
  {% if chapter.Chapters %}
    {% for chapter in chapter.Chapters %}
      "{{chapter.Chapter}}": "{{chapter.Canvas}}",
    {% endfor %}
  {% else %}
"{{chapter.Chapter}}": "{{chapter.Canvas}}"{% unless forloop.last %},{% endunless %}
  {% endif %}
{% endfor %}        
      }
      var searchParams = new URLSearchParams(location.search);
      var manifest = "manifest.json";
      var chapter_id = searchParams.get('c');
      var canvas = map[chapter_id];
      console.log(manifest + " - " + canvas);
      var miradorInstance = Mirador.viewer({
        id: 'mirador',
        theme: {
          transitions: window.location.port === '4488' ?  { create: () => 'none' } : {},
          palette: {
            annotations: {
              selected: { strokeStyle: '#ff0000', globalAlpha: 1 },
            }
          }
       },
       window: {
         panels: {
           search: false,
         },
         sideBarPanel: 'annotations',
         sideBarOpen: true,
         highlightAllAnnotations: true,
         views: [
          { key: 'single', behaviors: ['individuals', 'paged'] },
          { key: 'book', behaviors: ['paged'] },
          { key: 'scroll', behaviors: ['continuous'] },
          { key: 'gallery' },
        ],         
       },
       windows: [{
        id: 'known-window-id',
         manifestId: manifest,
         canvasId: canvas,
         thumbnailNavigation: 'off',
         defaultView: 'single',
       }],
     });

      // We create the action first. Note we are using a specified `windowId` here. This could be accessed from the store instead of specifying upfront.
//var action = Mirador.actions.setCanvas('known-window-id', 'https://permalinkbnd.bnportugal.gov.pt/iiif/69702/canvas/83')
// Now we can dispatch it.
//miradorInstance.store.dispatch(action);

// miradorInstance.store.dispatch(actions.addWindow());

    </script>
  </body>
</html>
